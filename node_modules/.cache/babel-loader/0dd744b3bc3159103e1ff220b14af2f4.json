{"ast":null,"code":"import _regeneratorRuntime from \"/home/mertmalaz/Desktop/atomic-swap_solidity (copy)/atomic-swap-solidity/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/mertmalaz/Desktop/atomic-swap_solidity (copy)/atomic-swap-solidity/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/home/mertmalaz/Desktop/atomic-swap_solidity (copy)/atomic-swap-solidity/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _possibleConstructorReturn from \"/home/mertmalaz/Desktop/atomic-swap_solidity (copy)/atomic-swap-solidity/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/mertmalaz/Desktop/atomic-swap_solidity (copy)/atomic-swap-solidity/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _createClass from \"/home/mertmalaz/Desktop/atomic-swap_solidity (copy)/atomic-swap-solidity/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/home/mertmalaz/Desktop/atomic-swap_solidity (copy)/atomic-swap-solidity/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/home/mertmalaz/Desktop/atomic-swap_solidity (copy)/atomic-swap-solidity/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/home/mertmalaz/Desktop/atomic-swap_solidity (copy)/atomic-swap-solidity/src/components/App.js\";\nimport React, { Component } from 'react';\nimport Web3 from 'web3';\nimport './App.css';\nimport ethAds from '../abis/ethereumAds.json';\n\nvar App =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(App, _Component);\n\n  _createClass(App, [{\n    key: \"componentDidMount\",\n    value: function () {\n      var _componentDidMount = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee() {\n        var contract_address, web3, accounts, abi, box_count_promise, box_count, c, i, box_url;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return this.loadWeb3();\n\n              case 2:\n                contract_address = \"0x783a37A8E947e9D99dc484AE1410A294C93C66bA\";\n                _context.next = 5;\n                return window.web3;\n\n              case 5:\n                web3 = _context.sent;\n                _context.next = 8;\n                return web3.eth.getAccounts();\n\n              case 8:\n                accounts = _context.sent;\n                this.setState({\n                  account: accounts[0]\n                });\n                web3.eth.defaultAccount = this.state.account;\n                abi = ethAds.abi;\n                _context.t0 = this;\n                _context.next = 15;\n                return new web3.eth.Contract(abi, contract_address);\n\n              case 15:\n                _context.t1 = _context.sent;\n                _context.t2 = {\n                  contract: _context.t1\n                };\n                _context.next = 19;\n                return _context.t0.setState.call(_context.t0, _context.t2);\n\n              case 19:\n                _context.next = 21;\n                return this.state.contract.methods.getBoxCount().call();\n\n              case 21:\n                box_count_promise = _context.sent;\n                box_count = parseInt(box_count_promise._hex, 16);\n                c = document.getElementById(\"grid\").children;\n                i = 0;\n\n              case 25:\n                if (!(i < box_count)) {\n                  _context.next = 33;\n                  break;\n                }\n\n                _context.next = 28;\n                return this.state.contract.methods.getUrl(i).call();\n\n              case 28:\n                box_url = _context.sent;\n                c[i].src = box_url;\n\n              case 30:\n                i++;\n                _context.next = 25;\n                break;\n\n              case 33:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function componentDidMount() {\n        return _componentDidMount.apply(this, arguments);\n      }\n\n      return componentDidMount;\n    }()\n  }, {\n    key: \"loadWeb3\",\n    value: function () {\n      var _loadWeb = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2() {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!window.ethereum) {\n                  _context2.next = 6;\n                  break;\n                }\n\n                window.web3 = new Web3(window.ethereum);\n                _context2.next = 4;\n                return window.ethereum.enable();\n\n              case 4:\n                _context2.next = 7;\n                break;\n\n              case 6:\n                if (window.web3) {\n                  window.web3 = new Web3(window.web3.currentProvider);\n                } else {\n                  window.alert(\"Web3 not supported in your browser.\");\n                }\n\n              case 7:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      function loadWeb3() {\n        return _loadWeb.apply(this, arguments);\n      }\n\n      return loadWeb3;\n    }()\n  }, {\n    key: \"loadBlockchainData\",\n    value: function () {\n      var _loadBlockchainData = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3() {\n        var web3, accounts, netw;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return this.loadWeb3();\n\n              case 2:\n                console.log(\"Loaded web3\");\n                _context3.next = 5;\n                return window.web3;\n\n              case 5:\n                web3 = _context3.sent;\n                _context3.next = 8;\n                return web3.eth.getAccounts();\n\n              case 8:\n                accounts = _context3.sent;\n                this.setState({\n                  account: accounts[0]\n                });\n                netw = \"\";\n                _context3.next = 13;\n                return web3.eth.net.getId().then(function (net_id) {\n                  switch (net_id) {\n                    case 1:\n                      netw = \"Mainnet\";\n                      break;\n\n                    case 3:\n                      netw = \"Ropsten\";\n                      break;\n\n                    case 42:\n                      netw = \"Kovan\";\n                      break;\n\n                    default:\n                      netw = 'This is an unknown network.';\n                  }\n                });\n\n              case 13:\n                this.setState({\n                  net: netw\n                });\n                console.log(this.state.net);\n                console.log(this.state.account);\n                web3.eth.defaultAccount = this.state.account;\n\n              case 17:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function loadBlockchainData() {\n        return _loadBlockchainData.apply(this, arguments);\n      }\n\n      return loadBlockchainData;\n    }()\n  }, {\n    key: \"interactBox\",\n    value: function () {\n      var _interactBox = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee4(_box_index) {\n        var web3, pricePromise, price, isBoxOwned, boxOwner, newUrl, newPrice;\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.next = 2;\n                return window.web3;\n\n              case 2:\n                web3 = _context4.sent;\n                _context4.next = 5;\n                return this.state.contract.methods.getPrice(_box_index).call();\n\n              case 5:\n                pricePromise = _context4.sent;\n                price = parseInt(pricePromise._hex, 16);\n                _context4.next = 9;\n                return this.state.contract.methods.isBoxOwned(_box_index).call();\n\n              case 9:\n                isBoxOwned = _context4.sent;\n                _context4.next = 12;\n                return this.state.contract.methods.getOwner(_box_index).call();\n\n              case 12:\n                boxOwner = _context4.sent;\n\n                if (!isBoxOwned) {\n                  _context4.next = 31;\n                  break;\n                }\n\n                if (!(boxOwner == this.state.account)) {\n                  _context4.next = 26;\n                  break;\n                }\n\n                // Owned by caller, set URL or price\n                console.log(\"set price or  url\");\n                _context4.next = 18;\n                return window.prompt(\"Enter new image URL\", \"\");\n\n              case 18:\n                newUrl = _context4.sent;\n\n                // update html url\n                if (newUrl != null && newUrl != \"\") {\n                  this.setUrl(_box_index, newUrl);\n                }\n\n                _context4.next = 22;\n                return window.prompt(\"Enter the new price\", \"\");\n\n              case 22:\n                newPrice = _context4.sent;\n\n                // update price in blockchain\n                if (newPrice != null && newPrice != \"\") {\n                  this.setPrice(_box_index, newPrice);\n                }\n\n                _context4.next = 29;\n                break;\n\n              case 26:\n                // Owned by another address, read the price and offer the transaction to the caller\n                console.log(\"owned by anther\");\n                _context4.next = 29;\n                return this.state.contract.methods.buyOwnedBox(_box_index).send({\n                  value: web3.utils.toWei(price.toString(), 'wei')\n                });\n\n              case 29:\n                _context4.next = 34;\n                break;\n\n              case 31:\n                // No owner\n                console.log(\"its empty, buy\");\n                _context4.next = 34;\n                return this.state.contract.methods.buyEmptyBox(_box_index).send({\n                  value: web3.utils.toWei(\"100\", 'wei')\n                });\n\n              case 34:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function interactBox(_x) {\n        return _interactBox.apply(this, arguments);\n      }\n\n      return interactBox;\n    }()\n  }, {\n    key: \"setUrl\",\n    value: function () {\n      var _setUrl = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee5(_box_index, url) {\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _context5.next = 2;\n                return this.state.contract.methods.setUrl(_box_index, url).send();\n\n              case 2:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function setUrl(_x2, _x3) {\n        return _setUrl.apply(this, arguments);\n      }\n\n      return setUrl;\n    }()\n  }, {\n    key: \"setPrice\",\n    value: function () {\n      var _setPrice = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee6(_box_index, price) {\n        return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _context6.next = 2;\n                return this.state.contract.methods.setPrice(_box_index, price).send();\n\n              case 2:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n\n      function setPrice(_x4, _x5) {\n        return _setPrice.apply(this, arguments);\n      }\n\n      return setPrice;\n    }() // TODO: Rent\n\n  }]);\n\n  function App(props) {\n    var _this;\n\n    _classCallCheck(this, App);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(App).call(this, props));\n    _this.state = {\n      account: \"\",\n      contract: \"\"\n    };\n    _this.interactBox = _this.interactBox.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return React.createElement(\"div\", {\n        class: \"grid\",\n        id: \"grid\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 135\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        name: \"grid0\",\n        class: \"grid-item\",\n        src: \"\",\n        onClick: function onClick() {\n          return _this2.interactBox(0);\n        },\n        alt: \"\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 136\n        },\n        __self: this\n      }), React.createElement(\"img\", {\n        name: \"grid1\",\n        class: \"grid-item\",\n        src: \"\",\n        onClick: function onClick() {\n          return _this2.interactBox(1);\n        },\n        alt: \"\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 137\n        },\n        __self: this\n      }), React.createElement(\"img\", {\n        name: \"grid2\",\n        class: \"grid-item\",\n        src: \"\",\n        onClick: function onClick() {\n          return _this2.interactBox(2);\n        },\n        alt: \"\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 138\n        },\n        __self: this\n      }), React.createElement(\"img\", {\n        name: \"grid3\",\n        class: \"grid-item\",\n        src: \"\",\n        onClick: function onClick() {\n          return _this2.interactBox(3);\n        },\n        alt: \"\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 139\n        },\n        __self: this\n      }), React.createElement(\"img\", {\n        name: \"grid4\",\n        class: \"grid-item\",\n        src: \"\",\n        onClick: function onClick() {\n          return _this2.interactBox(4);\n        },\n        alt: \"\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 140\n        },\n        __self: this\n      }), React.createElement(\"img\", {\n        name: \"grid5\",\n        class: \"grid-item\",\n        src: \"\",\n        onClick: function onClick() {\n          return _this2.interactBox(5);\n        },\n        alt: \"\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 141\n        },\n        __self: this\n      }), React.createElement(\"img\", {\n        name: \"grid6\",\n        class: \"grid-item\",\n        src: \"\",\n        onClick: function onClick() {\n          return _this2.interactBox(6);\n        },\n        alt: \"\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 142\n        },\n        __self: this\n      }), React.createElement(\"img\", {\n        name: \"grid7\",\n        class: \"grid-item\",\n        src: \"\",\n        onClick: function onClick() {\n          return _this2.interactBox(7);\n        },\n        alt: \"\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 143\n        },\n        __self: this\n      }), React.createElement(\"img\", {\n        name: \"grid8\",\n        class: \"grid-item\",\n        src: \"\",\n        onClick: function onClick() {\n          return _this2.interactBox(8);\n        },\n        alt: \"\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 144\n        },\n        __self: this\n      }), React.createElement(\"img\", {\n        name: \"grid9\",\n        class: \"grid-item\",\n        src: \"\",\n        onClick: function onClick() {\n          return _this2.interactBox(9);\n        },\n        alt: \"\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 145\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return App;\n}(Component);\n\nexport default App;","map":{"version":3,"sources":["/home/mertmalaz/Desktop/atomic-swap_solidity (copy)/atomic-swap-solidity/src/components/App.js"],"names":["React","Component","Web3","ethAds","App","loadWeb3","contract_address","window","web3","eth","getAccounts","accounts","setState","account","defaultAccount","state","abi","Contract","contract","methods","getBoxCount","call","box_count_promise","box_count","parseInt","_hex","c","document","getElementById","children","i","getUrl","box_url","src","ethereum","enable","currentProvider","alert","console","log","netw","net","getId","then","net_id","_box_index","getPrice","pricePromise","price","isBoxOwned","getOwner","boxOwner","prompt","newUrl","setUrl","newPrice","setPrice","buyOwnedBox","send","value","utils","toWei","toString","buyEmptyBox","url","props","interactBox","bind"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport Web3 from 'web3'\nimport './App.css';\nimport ethAds from '../abis/ethereumAds.json';\n\nclass App extends Component {\n\n  async componentDidMount() {\n    await this.loadWeb3();\n    const contract_address = \"0x783a37A8E947e9D99dc484AE1410A294C93C66bA\";\n    const web3 = await window.web3;\n\n    const accounts = await web3.eth.getAccounts()\n    this.setState({ account: accounts[0] })\n    web3.eth.defaultAccount = this.state.account;\n    \n \n   \n    \n\n    \n    const abi = ethAds.abi;\n\n    await this.setState({contract: await new web3.eth.Contract(abi, contract_address)}) // Use this to call the contract\n\n    var box_count_promise = await this.state.contract.methods.getBoxCount().call();\n    const box_count = parseInt(box_count_promise._hex, 16)\n    \n    var c = document.getElementById(\"grid\").children;\n    var i;\n    for (i = 0; i < box_count; i++) {\n      const box_url = await this.state.contract.methods.getUrl(i).call();\n      c[i].src = box_url;\n    }\n  }\n\n  async loadWeb3() {\n    if (window.ethereum) {\n      window.web3 = new Web3(window.ethereum)\n      await window.ethereum.enable()\n    }\n    else if (window.web3) {\n      window.web3 = new Web3(window.web3.currentProvider)\n    }\n    else {\n      window.alert(\"Web3 not supported in your browser.\")\n    }\n  }\n\n  async loadBlockchainData() {\n    await this.loadWeb3();\n    console.log(\"Loaded web3\");\n    const web3 = await window.web3;\n\n    const accounts = await web3.eth.getAccounts()\n    this.setState({ account: accounts[0] })\n    var netw = \"\"\n    await web3.eth.net.getId().then(net_id => {\n      switch (net_id) {\n        case 1:\n          netw = \"Mainnet\"\n          break\n        case 3:\n          netw = \"Ropsten\"\n          break\n        case 42:\n          netw = \"Kovan\"\n          break\n        default:\n          netw = 'This is an unknown network.'\n      }\n    })\n    this.setState({ net: netw })\n    console.log(this.state.net)\n    console.log(this.state.account)\n    web3.eth.defaultAccount = this.state.account;\n  }\n\n  async interactBox(_box_index) {\n    const web3 = await window.web3;\n\n    var pricePromise = await this.state.contract.methods.getPrice(_box_index).call();\n    const price = parseInt(pricePromise._hex, 16)\n\n    var isBoxOwned = await this.state.contract.methods.isBoxOwned(_box_index).call();\n    var boxOwner = await this.state.contract.methods.getOwner(_box_index).call();\n\n    if (isBoxOwned) {\n      if (boxOwner == this.state.account) { // Owned by caller, set URL or price\n        console.log(\"set price or  url\");\n        var newUrl = await window.prompt(\"Enter new image URL\", \"\"); // update html url\n        if(newUrl != null && newUrl != \"\"){ \n          this.setUrl(_box_index, newUrl); \n        }\n        \n        var newPrice = await window.prompt(\"Enter the new price\", \"\"); // update price in blockchain\n        if(newPrice != null && newPrice != \"\"){ \n          this.setPrice(_box_index, newPrice); \n        }\n      }\n      else { // Owned by another address, read the price and offer the transaction to the caller\n        console.log(\"owned by anther\");\n        await this.state.contract.methods.buyOwnedBox(_box_index).send({ value: web3.utils.toWei(price.toString(), 'wei') });\n      }\n    }\n    else { // No owner\n      console.log(\"its empty, buy\");\n      await this.state.contract.methods.buyEmptyBox(_box_index).send({ value: web3.utils.toWei(\"100\", 'wei') });\n    }\n  }\n\n  async setUrl(_box_index, url){\n    await this.state.contract.methods.setUrl(_box_index, url).send();\n    // TODO: Change the image without refreshing\n  }\n\n  async setPrice(_box_index, price){\n    await this.state.contract.methods.setPrice(_box_index, price).send();\n  }\n\n  // TODO: Rent\n\n\n  constructor(props) {\n    super(props)\n    this.state = {\n      account: \"\",\n      contract: \"\"\n    }\n    this.interactBox = this.interactBox.bind(this)\n  }\n\n  render() {\n    return (\n      <div class=\"grid\" id=\"grid\">\n        <img name=\"grid0\" class=\"grid-item\" src=\"\" onClick={() => this.interactBox(0)} alt=\"\"></img>\n        <img name=\"grid1\" class=\"grid-item\" src=\"\" onClick={() => this.interactBox(1)} alt=\"\"></img>\n        <img name=\"grid2\" class=\"grid-item\" src=\"\" onClick={() => this.interactBox(2)} alt=\"\"></img>\n        <img name=\"grid3\" class=\"grid-item\" src=\"\" onClick={() => this.interactBox(3)} alt=\"\"></img>\n        <img name=\"grid4\" class=\"grid-item\" src=\"\" onClick={() => this.interactBox(4)} alt=\"\"></img>\n        <img name=\"grid5\" class=\"grid-item\" src=\"\" onClick={() => this.interactBox(5)} alt=\"\"></img>\n        <img name=\"grid6\" class=\"grid-item\" src=\"\" onClick={() => this.interactBox(6)} alt=\"\"></img>\n        <img name=\"grid7\" class=\"grid-item\" src=\"\" onClick={() => this.interactBox(7)} alt=\"\"></img>\n        <img name=\"grid8\" class=\"grid-item\" src=\"\" onClick={() => this.interactBox(8)} alt=\"\"></img>\n        <img name=\"grid9\" class=\"grid-item\" src=\"\" onClick={() => this.interactBox(9)} alt=\"\"></img>\n      </div>\n    );\n  }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}