{"ast":null,"code":"import _regeneratorRuntime from \"/home/mertmalaz/Desktop/atomic-swap_solidity (copy)/atomic-swap-solidity/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/mertmalaz/Desktop/atomic-swap_solidity (copy)/atomic-swap-solidity/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/home/mertmalaz/Desktop/atomic-swap_solidity (copy)/atomic-swap-solidity/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _possibleConstructorReturn from \"/home/mertmalaz/Desktop/atomic-swap_solidity (copy)/atomic-swap-solidity/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/mertmalaz/Desktop/atomic-swap_solidity (copy)/atomic-swap-solidity/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _createClass from \"/home/mertmalaz/Desktop/atomic-swap_solidity (copy)/atomic-swap-solidity/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _inherits from \"/home/mertmalaz/Desktop/atomic-swap_solidity (copy)/atomic-swap-solidity/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/home/mertmalaz/Desktop/atomic-swap_solidity (copy)/atomic-swap-solidity/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/home/mertmalaz/Desktop/atomic-swap_solidity (copy)/atomic-swap-solidity/src/components/App.js\";\nimport React, { Component } from 'react';\nimport Web3 from 'web3';\nimport './App.css';\nimport ethAds from '../abis/ethereumAds.json';\n\nvar App =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(App, _Component);\n\n  _createClass(App, [{\n    key: \"componentDidMount\",\n    value: function () {\n      var _componentDidMount = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee() {\n        var web3, accounts, contract_address, abi, box_count_promise, box_count, c, i, box_url;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return this.loadWeb3();\n\n              case 2:\n                _context.next = 4;\n                return window.web3;\n\n              case 4:\n                web3 = _context.sent;\n                _context.next = 7;\n                return web3.eth.getAccounts();\n\n              case 7:\n                accounts = _context.sent;\n                this.setState({\n                  account: accounts[0]\n                });\n                web3.eth.defaultAccount = this.state.account;\n                contract_address = \"0x783a37A8E947e9D99dc484AE1410A294C93C66bA\";\n                abi = ethAds.abi;\n                _context.t0 = this;\n                _context.next = 15;\n                return new web3.eth.Contract(abi, contract_address);\n\n              case 15:\n                _context.t1 = _context.sent;\n                _context.t2 = {\n                  contract: _context.t1\n                };\n                _context.next = 19;\n                return _context.t0.setState.call(_context.t0, _context.t2);\n\n              case 19:\n                _context.next = 21;\n                return this.state.contract.methods.getBoxCount().call();\n\n              case 21:\n                box_count_promise = _context.sent;\n                box_count = parseInt(box_count_promise._hex, 16);\n                c = document.getElementById(\"grid\").children;\n                i = 0;\n\n              case 25:\n                if (!(i < box_count)) {\n                  _context.next = 33;\n                  break;\n                }\n\n                _context.next = 28;\n                return this.state.contract.methods.getUrl(i).call();\n\n              case 28:\n                box_url = _context.sent;\n                c[i].src = box_url;\n\n              case 30:\n                i++;\n                _context.next = 25;\n                break;\n\n              case 33:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function componentDidMount() {\n        return _componentDidMount.apply(this, arguments);\n      }\n\n      return componentDidMount;\n    }()\n  }, {\n    key: \"loadWeb3\",\n    value: function () {\n      var _loadWeb = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee2() {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!window.ethereum) {\n                  _context2.next = 6;\n                  break;\n                }\n\n                window.web3 = new Web3(window.ethereum);\n                _context2.next = 4;\n                return window.ethereum.enable();\n\n              case 4:\n                _context2.next = 7;\n                break;\n\n              case 6:\n                if (window.web3) {\n                  window.web3 = new Web3(window.web3.currentProvider);\n                } else {\n                  window.alert(\"Web3 not supported in your browser.\");\n                }\n\n              case 7:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      function loadWeb3() {\n        return _loadWeb.apply(this, arguments);\n      }\n\n      return loadWeb3;\n    }()\n  }, {\n    key: \"interactBox\",\n    value: function () {\n      var _interactBox = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee3(_box_index) {\n        var web3, pricePromise, price, isBoxOwned, boxOwner, newUrl, newPrice;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return window.web3;\n\n              case 2:\n                web3 = _context3.sent;\n                _context3.next = 5;\n                return this.state.contract.methods.getPrice(_box_index).call();\n\n              case 5:\n                pricePromise = _context3.sent;\n                price = parseInt(pricePromise._hex, 16);\n                _context3.next = 9;\n                return this.state.contract.methods.isBoxOwned(_box_index).call();\n\n              case 9:\n                isBoxOwned = _context3.sent;\n                _context3.next = 12;\n                return this.state.contract.methods.getOwner(_box_index).call();\n\n              case 12:\n                boxOwner = _context3.sent;\n\n                if (!isBoxOwned) {\n                  _context3.next = 31;\n                  break;\n                }\n\n                if (!(boxOwner == this.state.account)) {\n                  _context3.next = 26;\n                  break;\n                }\n\n                // Owned by caller, set URL or price\n                console.log(\"set price or  url\");\n                _context3.next = 18;\n                return window.prompt(\"Enter new image URL\", \"\");\n\n              case 18:\n                newUrl = _context3.sent;\n\n                // update html url\n                if (newUrl != null && newUrl != \"\") {\n                  this.setUrl(_box_index, newUrl);\n                }\n\n                _context3.next = 22;\n                return window.prompt(\"Enter the new price\", \"\");\n\n              case 22:\n                newPrice = _context3.sent;\n\n                // update price in blockchain\n                if (newPrice != null && newPrice != \"\") {\n                  this.setPrice(_box_index, newPrice);\n                }\n\n                _context3.next = 29;\n                break;\n\n              case 26:\n                // Owned by another address, read the price and offer the transaction to the caller\n                console.log(\"owned by anther\");\n                _context3.next = 29;\n                return this.state.contract.methods.buyOwnedBox(_box_index).send({\n                  value: web3.utils.toWei(price.toString(), 'wei')\n                });\n\n              case 29:\n                _context3.next = 34;\n                break;\n\n              case 31:\n                // No owner\n                console.log(\"its empty, buy\");\n                _context3.next = 34;\n                return this.state.contract.methods.buyEmptyBox(_box_index).send({\n                  value: web3.utils.toWei(\"100\", 'wei')\n                });\n\n              case 34:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function interactBox(_x) {\n        return _interactBox.apply(this, arguments);\n      }\n\n      return interactBox;\n    }()\n  }, {\n    key: \"setUrl\",\n    value: function () {\n      var _setUrl = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee4(_box_index, url) {\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.next = 2;\n                return this.state.contract.methods.setUrl(_box_index, url).send();\n\n              case 2:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function setUrl(_x2, _x3) {\n        return _setUrl.apply(this, arguments);\n      }\n\n      return setUrl;\n    }()\n  }, {\n    key: \"setPrice\",\n    value: function () {\n      var _setPrice = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee5(_box_index, price) {\n        return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _context5.next = 2;\n                return this.state.contract.methods.setPrice(_box_index, price).send();\n\n              case 2:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n\n      function setPrice(_x4, _x5) {\n        return _setPrice.apply(this, arguments);\n      }\n\n      return setPrice;\n    }() // TODO: Rent\n\n  }]);\n\n  function App(props) {\n    var _this;\n\n    _classCallCheck(this, App);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(App).call(this, props));\n    _this.state = {\n      account: \"\",\n      contract: \"\"\n    };\n    _this.interactBox = _this.interactBox.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(App, [{\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      return React.createElement(\"div\", {\n        class: \"grid\",\n        id: \"grid\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 101\n        },\n        __self: this\n      }, React.createElement(\"img\", {\n        name: \"grid0\",\n        class: \"grid-item\",\n        src: \"\",\n        onClick: function onClick() {\n          return _this2.interactBox(0);\n        },\n        alt: \"\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 102\n        },\n        __self: this\n      }), React.createElement(\"img\", {\n        name: \"grid1\",\n        class: \"grid-item\",\n        src: \"\",\n        onClick: function onClick() {\n          return _this2.interactBox(1);\n        },\n        alt: \"\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 103\n        },\n        __self: this\n      }), React.createElement(\"img\", {\n        name: \"grid2\",\n        class: \"grid-item\",\n        src: \"\",\n        onClick: function onClick() {\n          return _this2.interactBox(2);\n        },\n        alt: \"\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 104\n        },\n        __self: this\n      }), React.createElement(\"img\", {\n        name: \"grid3\",\n        class: \"grid-item\",\n        src: \"\",\n        onClick: function onClick() {\n          return _this2.interactBox(3);\n        },\n        alt: \"\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 105\n        },\n        __self: this\n      }), React.createElement(\"img\", {\n        name: \"grid4\",\n        class: \"grid-item\",\n        src: \"\",\n        onClick: function onClick() {\n          return _this2.interactBox(4);\n        },\n        alt: \"\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 106\n        },\n        __self: this\n      }), React.createElement(\"img\", {\n        name: \"grid5\",\n        class: \"grid-item\",\n        src: \"\",\n        onClick: function onClick() {\n          return _this2.interactBox(5);\n        },\n        alt: \"\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 107\n        },\n        __self: this\n      }), React.createElement(\"img\", {\n        name: \"grid6\",\n        class: \"grid-item\",\n        src: \"\",\n        onClick: function onClick() {\n          return _this2.interactBox(6);\n        },\n        alt: \"\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 108\n        },\n        __self: this\n      }), React.createElement(\"img\", {\n        name: \"grid7\",\n        class: \"grid-item\",\n        src: \"\",\n        onClick: function onClick() {\n          return _this2.interactBox(7);\n        },\n        alt: \"\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 109\n        },\n        __self: this\n      }), React.createElement(\"img\", {\n        name: \"grid8\",\n        class: \"grid-item\",\n        src: \"\",\n        onClick: function onClick() {\n          return _this2.interactBox(8);\n        },\n        alt: \"\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 110\n        },\n        __self: this\n      }), React.createElement(\"img\", {\n        name: \"grid9\",\n        class: \"grid-item\",\n        src: \"\",\n        onClick: function onClick() {\n          return _this2.interactBox(9);\n        },\n        alt: \"\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 111\n        },\n        __self: this\n      }));\n    }\n  }]);\n\n  return App;\n}(Component);\n\nexport default App;","map":{"version":3,"sources":["/home/mertmalaz/Desktop/atomic-swap_solidity (copy)/atomic-swap-solidity/src/components/App.js"],"names":["React","Component","Web3","ethAds","App","loadWeb3","window","web3","eth","getAccounts","accounts","setState","account","defaultAccount","state","contract_address","abi","Contract","contract","methods","getBoxCount","call","box_count_promise","box_count","parseInt","_hex","c","document","getElementById","children","i","getUrl","box_url","src","ethereum","enable","currentProvider","alert","_box_index","getPrice","pricePromise","price","isBoxOwned","getOwner","boxOwner","console","log","prompt","newUrl","setUrl","newPrice","setPrice","buyOwnedBox","send","value","utils","toWei","toString","buyEmptyBox","url","props","interactBox","bind"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport Web3 from 'web3'\nimport './App.css';\nimport ethAds from '../abis/ethereumAds.json';\n\nclass App extends Component {\n\n  async componentDidMount() {\n    await this.loadWeb3();\n    const web3 = await window.web3;\n\n    const accounts = await web3.eth.getAccounts()\n    this.setState({ account: accounts[0] })\n    web3.eth.defaultAccount = this.state.account;\n    \n    const contract_address = \"0x783a37A8E947e9D99dc484AE1410A294C93C66bA\"; \n    const abi = ethAds.abi;\n\n    await this.setState({contract: await new web3.eth.Contract(abi, contract_address)}) // Use this to call the contract\n\n    var box_count_promise = await this.state.contract.methods.getBoxCount().call();\n    const box_count = parseInt(box_count_promise._hex, 16)\n    \n    var c = document.getElementById(\"grid\").children;\n    var i;\n    for (i = 0; i < box_count; i++) {\n      const box_url = await this.state.contract.methods.getUrl(i).call();\n      c[i].src = box_url;\n    }\n  }\n\n  async loadWeb3() {\n    if (window.ethereum) {\n      window.web3 = new Web3(window.ethereum)\n      await window.ethereum.enable()\n    }\n    else if (window.web3) {\n      window.web3 = new Web3(window.web3.currentProvider)\n    }\n    else {\n      window.alert(\"Web3 not supported in your browser.\")\n    }\n  }\n\n  async interactBox(_box_index) {\n    const web3 = await window.web3;\n\n    var pricePromise = await this.state.contract.methods.getPrice(_box_index).call();\n    const price = parseInt(pricePromise._hex, 16)\n\n    var isBoxOwned = await this.state.contract.methods.isBoxOwned(_box_index).call();\n    var boxOwner = await this.state.contract.methods.getOwner(_box_index).call();\n\n    if (isBoxOwned) {\n      if (boxOwner == this.state.account) { // Owned by caller, set URL or price\n        console.log(\"set price or  url\");\n        var newUrl = await window.prompt(\"Enter new image URL\", \"\"); // update html url\n        if(newUrl != null && newUrl != \"\"){ \n          this.setUrl(_box_index, newUrl); \n        }\n        \n        var newPrice = await window.prompt(\"Enter the new price\", \"\"); // update price in blockchain\n        if(newPrice != null && newPrice != \"\"){ \n          this.setPrice(_box_index, newPrice); \n        }\n      }\n      else { // Owned by another address, read the price and offer the transaction to the caller\n        console.log(\"owned by anther\");\n        await this.state.contract.methods.buyOwnedBox(_box_index).send({ value: web3.utils.toWei(price.toString(), 'wei') });\n      }\n    }\n    else { // No owner\n      console.log(\"its empty, buy\");\n      await this.state.contract.methods.buyEmptyBox(_box_index).send({ value: web3.utils.toWei(\"100\", 'wei') });\n    }\n  }\n\n  async setUrl(_box_index, url){\n    await this.state.contract.methods.setUrl(_box_index, url).send();\n    // TODO: Change the image without refreshing\n  }\n\n  async setPrice(_box_index, price){\n    await this.state.contract.methods.setPrice(_box_index, price).send();\n  }\n\n  // TODO: Rent\n\n\n  constructor(props) {\n    super(props)\n    this.state = {\n      account: \"\",\n      contract: \"\"\n    }\n    this.interactBox = this.interactBox.bind(this)\n  }\n\n  render() {\n    return (\n      <div class=\"grid\" id=\"grid\">\n        <img name=\"grid0\" class=\"grid-item\" src=\"\" onClick={() => this.interactBox(0)} alt=\"\"></img>\n        <img name=\"grid1\" class=\"grid-item\" src=\"\" onClick={() => this.interactBox(1)} alt=\"\"></img>\n        <img name=\"grid2\" class=\"grid-item\" src=\"\" onClick={() => this.interactBox(2)} alt=\"\"></img>\n        <img name=\"grid3\" class=\"grid-item\" src=\"\" onClick={() => this.interactBox(3)} alt=\"\"></img>\n        <img name=\"grid4\" class=\"grid-item\" src=\"\" onClick={() => this.interactBox(4)} alt=\"\"></img>\n        <img name=\"grid5\" class=\"grid-item\" src=\"\" onClick={() => this.interactBox(5)} alt=\"\"></img>\n        <img name=\"grid6\" class=\"grid-item\" src=\"\" onClick={() => this.interactBox(6)} alt=\"\"></img>\n        <img name=\"grid7\" class=\"grid-item\" src=\"\" onClick={() => this.interactBox(7)} alt=\"\"></img>\n        <img name=\"grid8\" class=\"grid-item\" src=\"\" onClick={() => this.interactBox(8)} alt=\"\"></img>\n        <img name=\"grid9\" class=\"grid-item\" src=\"\" onClick={() => this.interactBox(9)} alt=\"\"></img>\n      </div>\n    );\n  }\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}